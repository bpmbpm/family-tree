## mermaid vs graphviz

Похоже mermaid не поддерживает встраивание картинок. Тогда вместо mermaid используй библиотеку graphviz (dot).
---

Мы получили два важных уточнения от пользователя. Во-первых, он хочет использовать <br> для переноса строк вместо \n. Во-вторых, он считает, что Mermaid не поддерживает встраивание картинок, и предлагает перейти на Graphviz (dot).

Нужно оценить ситуацию. Из предыдущей переписки и результатов поиска видно, что Mermaid действительно может отображать HTML внутри узлов при включенных опциях htmlLabels: true и securityLevel: 'loose' . Мы это уже использовали в коде для вставки фото через <foreignObject>. Однако это работает только при рендеринге на странице, но не при экспорте в mermaid.live, и требует дополнительной кастомизации после рендера.

Главная проблема, с которой столкнулся пользователь, — что ссылка на mermaid.live ведёт на схему без фото и с неправильным переносом. Это потому, что в код экспорта мы вставляли \n, а Mermaid ожидает либо \n, либо HTML-теги, но для экспорта в live editor HTML может не поддерживаться.

Поэтому предложение пользователя перейти на Graphviz (dot) — разумное решение, если цель — получить самодостаточную диаграмму со встроенными изображениями, которую можно открыть в любом месте.

Из результатов поиска мы видим:

Есть библиотека kingraph, которая строит семейные деревья на основе YAML и экспортирует в Graphviz 

Существуют способы интеграции Graphviz с JavaScript через WebAssembly (например, hpcc-js-wasm) 

Библиотека parenthood парсит простой текстовый формат и генерирует dot-код 

Это подтверждает, что Graphviz — подходящий инструмент.

Теперь задача: переписать программу с Mermaid на Graphviz. Нужно:

Сохранить загрузку Excel, парсинг данных.

Генерировать код на языке DOT.

Использовать JavaScript-библиотеку для рендеринга DOT в SVG/HTML.

Встроить изображения в узлы — в Graphviz для этого есть механизм HTML-подобных меток (узлы формы shape=none и label=<<TABLE>...</TABLE>>).

Обеспечить перенос строк с помощью <BR/>.

Сделать ссылку на просмотр в онлайн-редакторе Graphviz (например, на viz-js.com), используя сжатие.

План действий:

Заменить Mermaid на библиотеку @hpcc-js/wasm или viz.js (или использовать d3-graphviz).

В коде генерации заменить синтаксис Mermaid на DOT.

Для фото: в DOT используем HTML-таблицы для размещения картинки слева и текста справа с переносом строк.

Для экспорта сжимаем DOT-код и формируем ссылку на http://viz-js.com (он принимает данные в URL через # как Graphviz).

Таким образом, пользователь получит полностью автономную диаграмму с фото, переносами строк и работающей ссылкой на онлайн-редактор.
