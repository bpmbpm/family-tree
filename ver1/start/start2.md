### comments 1
Замечания:
1 Нет минифото, которые должны отображаться слева от блока информации по персоне (как в классическом family tree). Папка /pic с минифото имеется.  
2 год рождения и год смерти должны быть на отдельной строке.
3 для мужчин рамка должна быть синей, а для женщин розовой
4 По кнопке «Открыть в mermaid.live» отображается не эта схема, а другая.

---

Мы получили список замечаний к предыдущему решению:

Нет минифото слева от блока информации (как в классическом family tree). У нас есть папка /pic с минифото.

Год рождения и смерти должны быть на отдельной строке.

Рамка для мужчин – синяя, для женщин – розовая.

По кнопке «Открыть в mermaid.live» отображается не та схема (вероятно, потому что мы вставляем HTML через foreignObject, а в mermaid.live рендерится обычный код без кастомизации; нужно или передавать код как есть, или сделать так, чтобы в mermaid.live была похожая схема? Но требование, вероятно, в том, чтобы по кнопке открывалась именно та схема, что на странице, но без фото и с рамками? Либо просто передавать корректный код mermaid, который у нас генерируется. Но код с foreignObject не поддерживается mermaid.live. Поэтому возможно надо передавать код без кастомизации, но сохраняя информацию о поле для рамок? Но mermaid.live не умеет в рамки по полу, если мы не используем стили через classDef. Мы можем добавить стили через classDef и использовать их. Тогда в mermaid.live увидят раскрашенные рамки. А фото не будут отображаться, потому что foreignObject не поддерживается. Это приемлемо.

То есть нужно:

Убрать foreignObject, а для отображения фото на странице использовать кастомный рендеринг после mermaid, но при этом в самом mermaid коде должны быть классы для пола (например, classDef male fill:#lightblue, classDef female fill:pink). Тогда в предварительном просмотре на странице фото будут наложены поверх (или заменять стандартные узлы). При этом в mermaid.live увидят цветные прямоугольники без фото. Это нормально.

Для расположения фото слева и года на отдельной строке: в кастомном рендеринге после mermaid мы должны модифицировать каждый узел так, чтобы он содержал фото слева и текст в две строки. Это можно сделать так же через foreignObject, но теперь мы должны сохранить цвет рамки, заданный через класс. Для этого можно определить стили для male/female через CSS, а не через fill атрибут Mermaid. Или оставить fill, а затем в foreignObject подложить свой div с фоном.

Лучше: после рендера Mermaid мы имеем SVG с группами. Для каждого узла мы определяем его пол по данным people, находим соответствующую группу и заменяем её содержимое на foreignObject с нужным оформлением. При этом мы можем скопировать цвет фона из класса? Но мы можем сами задать цвет фона в div в зависимости от пола. Это проще.

Для года на отдельной строке: внутри foreignObject размещаем div с flex-колонкой.

Фото слева: внутри flex-row.

Таким образом, после рендера Mermaid (который рисует простые прямоугольники с текстом), мы заменяем каждый узел на кастомный HTML внутри foreignObject, но при этом мы не полагаемся на fill из Mermaid. Мы сами красим фон.

Для кнопки mermaid.live: используем код mermaid до замены (т.е. без foreignObject), но с добавленными определениями классов для цвета (male/female). Нужно добавить в код classDef и применить их к узлам. При этом узлы уже содержат текст в одну строку (имя и даты). Это не соответствует требованию "год на отдельной строке" в mermaid.live, но это допустимо, потому что mermaid.live не поддерживает сложный HTML. Основное требование к mermaid.live, чтобы схема была похожа, но не идентична.

Итак, план:

При генерации mermaidCode добавим:

для каждого человека узел с меткой "Имя (год-год)" – так и оставим.

добавим classDef для male (fill:lightblue, stroke:#333, stroke-width:1px) и female (fill:pink). Также применим эти классы к узлам в зависимости от пола.

После рендера, для каждого узла заменим его содержимое на foreignObject с HTML, где:

слева <img> с фото (из .pic/idA.png или default).

справа <div> с именем и отдельной строкой годов.

фон div зависит от пола (lightblue/pink).

Сохраним связи как есть.

Также учтём, что люди без пола? По умолчанию серая рамка.

Реализуем это.

Теперь напишем новый код.

